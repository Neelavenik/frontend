"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="fc004411-036f-5b60-b3b0-2996a2556f17")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5099],{24973:(e,t,l)=>{l.d(t,{Mf:()=>n,vR:()=>a,xR:()=>s});let a="tab_group--tabs--ChhR5",n="tab_group--tab--j43X-",s="tab_group--selectedTab--dwZ1b tab_group--tab--j43X-"},901765:(e,t,l)=>{l.d(t,{L:()=>n});var a=l(411855);function n(e,t,l){a.useEffect(()=>{let a=a=>{let n=a.target;l&&!n.isConnected||e.current?.contains(n)||t()};return document.addEventListener("click",a),()=>{document.removeEventListener("click",a)}})}},706638:(e,t,l)=>{l.d(t,{P:()=>K,v:()=>O});var a=l(411855),n=l(188507),s=l(598045),d=l(539321);if(443==l.j)var o=l(395096);var r=l(776250),i=l(358145),c=l(395900),u=l(268537),m=l(493323),f=l(135876),p=l(827586),g=l(32863),E=l(574176),b=l(939863),h=l(738269),C=l(15859),v=l(318812),y=l(29680),k=l(463592),N=l(103271),I=l(720488),_=l(406158),P=l(780634);if(443==l.j)var x=l(949207);if(443==l.j)var M=l(156238);if(443==l.j)var S=l(432023);var O=(e=>(e.LOADED="post-to-feed-view-loaded",e.SELECT_NODE="post-to-feed-select-node",e))(O||{});function F(e){return a.createElement("div",{className:null!==e.isSelectedIdx?P.El:P.Vs,onClick:e.onClick,role:"button",tabIndex:0,ref:t=>{t&&e.observe(t)},"data-observer-guid":e.node.guid},a.createElement("div",{className:P.h3,style:{backgroundColor:e.backgroundColor}},a.createElement(f.x,{isLoading:!e.thumbnailUrl},()=>a.createElement("img",{className:P.xn,src:e.thumbnailUrl,alt:"",draggable:!1}))),a.createElement("div",{className:P.JO},a.createElement("div",{className:P.qp},e.node.name)),null!==e.isSelectedIdx&&1!==e.totalNumSelected&&a.createElement("div",{className:P.Jx},e.isSelectedIdx+1))}function T(e){let{toggleSelectNode:t}=e,l=(e.pageNode&&(0,d.colorToHex)(e.pageNode.backgroundColor))??"",[n,s]=a.useState(!1),o=a.useCallback(a=>{t(a,{pageId:e.pageNode.guid,pageBackgroundColor:l})},[t,e.pageNode.guid,l]);return a.createElement("div",{className:P.RW},e.showCollapsibleHeader&&a.createElement("div",{className:P.Vr,onClick:()=>s(e=>!e),role:"button",tabIndex:0},n?a.createElement(E.B,{svg:S.A,className:P.Rq}):a.createElement(E.B,{svg:x.A,className:P.Rq}),e.pageNode.name,"\xa0",a.createElement("span",{className:P.Du},"\xb7 ",e.nodes.length)),!n&&a.createElement("div",{className:P.Mc},e.nodes.map(t=>{let n=e.selectedNodeGuids?.indexOf(t.guid)??null;return a.createElement(F,{key:`node-${t.guid}`,node:t,thumbnailUrl:e.thumbnailByGuid[t.guid]?.url??"",backgroundColor:l,isSelectedIdx:-1===n?null:n,onClick:()=>o(t.guid),totalNumSelected:e.selectedNodeGuids?.length??null,observe:e.observe})})))}let w="feed-post-page-selector-menu";function K(){let e=a.useCallback((e,t)=>{let l=window.parent;window.self.origin===l.origin&&l&&l.postMessage({type:e,data:t})},[]),t=a.useRef(new c.jk("feed_post_to_file_load",{}));a.useEffect(()=>{t.current.start()},[]);let l=(0,y.aV)(),d=(0,y.eY)(),f=(0,n.d4)(e=>e.openFile?.key);a.useEffect(()=>{if(!l){t.current.stop();let l=t.current.getElapsedTime();(0,r.sx)("team_feed.post_from_file.file_load",{elapsedMs:l,fileKey:f}),e("post-to-feed-view-loaded",!0)}},[l,e,f]);let x=(0,n.d4)(e=>e.mirror.appModel.pagesList),S=a.useMemo(()=>x.reduce((e,t)=>({...e,[t.nodeId]:d.get(t.nodeId)}),{}),[x,d]),O=(0,n.wA)(),F=a.useMemo(()=>Object.values(S).flatMap(e=>e?e.uiOrderedChildren.map(t=>{let l=d.get(t);return l&&("FRAME"===l.type||"SECTION"===l.type)?{...l,pageId:e.guid,name:l?.name}:null}).filter(e=>e):[]).filter(e=>null!==e),[S,d]),K=a.useMemo(()=>{let e={};for(let t of F)e[t.pageId]?e[t.pageId].push(t):e[t.pageId]=[t];return e},[F]),D=a.useMemo(()=>new k.Ef(F,{keys:["name"]}),[F]),[R,j]=a.useState(""),[A,U]=a.useState(null),[L]=(0,o.A)(R,200),B=a.useCallback(e=>{U(D.search(e))},[D]),Y=a.useMemo(()=>{if(null===A)return null;let e={};for(let t of A)e[t.pageId]?e[t.pageId].push(t):e[t.pageId]=[t];return e},[A]);a.useEffect(()=>{""!==L&&B(L)},[L,B]);let Z=(0,v.Um)(),q=a.useRef(null),[z,G]=a.useState(null);a.useEffect(()=>{if(z||!d||!K||0===Object.keys(K).length)return;let e=d.get(Object.keys(K)[0]);e&&G(e)},[z,K,d]);let[H,J]=a.useState({}),[V,W]=a.useState([]),$=(0,i.ZC)(V),X=a.useRef(null),[Q,ee]=a.useState([]),et=a.useCallback(e=>{let t=[];e.forEach(e=>{if(e.isIntersecting&&e.target instanceof HTMLElement){let l=e.target.dataset?.observerGuid;l&&t.push(l)}}),ee(t)},[]),el=a.useMemo(()=>new IntersectionObserver(et,{threshold:[.25]}),[et]),ea=a.useCallback(e=>{el&&el.observe(e)},[el]),[en,es]=a.useState({});a.useEffect(()=>{if(0===Q.length)return;let e=Q.filter(e=>!en[e]);0!==e.length&&(0,C.Jr)().loadAllImagesUnder(e,s.MoD.NON_ANIMATED_ONLY,"feed.postFromFile").then(()=>{e.forEach(e=>{setTimeout(()=>{es(t=>{if(t[e])return t;let l=(0,_.BO)(e);return{...t,[e]:{url:URL.createObjectURL(new Blob([l])),data:l}}})},0)})})},[Q,en]),a.useEffect(()=>{V!==$&&e("post-to-feed-select-node",V.map(e=>({guid:e,thumbnail:en[e].data,backgroundColor:H[e]})))},[$,V,e,en,H]);let ed=a.useCallback((e,t)=>{en[e]&&(J(l=>t.pageBackgroundColor?{...l,[e]:t.pageBackgroundColor}:l),W(t=>t.includes(e)?t.filter(t=>e!==t):t.length>=N.e3?t:[...t,e]))},[en]);return K&&0===Object.keys(K).length?a.createElement("div",{className:P.se},(0,b.t)("fig_feed.no_top_level_nodes")):z?a.createElement("div",{className:P.kL},a.createElement("div",{className:P.Y},a.createElement(g.IW,{query:R,className:P.ON,onChange:j,clearSearch:()=>{j(""),U(null)},focusOnMount:!1,iconClassName:P.qc,placeholder:(0,b.t)("fig_feed.search_frames")}),""===R&&a.createElement(a.Fragment,null,a.createElement("div",{role:"button",ref:q,onClick:()=>{Z?.type===w?O(h.oB()):O(h.j7({type:w}))},tabIndex:0,className:P.YZ},a.createElement("div",null,z.name),a.createElement(E.B,{svg:M.A,width:"8px",autosize:!0})),q.current&&Z?.type===w&&a.createElement(I.Cf,{showPoint:!1,targetRect:q.current.getBoundingClientRect(),propagateCloseClick:!0},Object.keys(K).map(e=>a.createElement(u.MM,{key:e,onClick:()=>G(S[e]),checked:z.guid===e},S[e].name))))),a.createElement(p.P,{hideScrollbar:!0,className:P.jG,innerClassName:P.hu,scrollContainerRef:X},""===R&&a.createElement(T,{pageNode:z,nodes:K[z.guid]||[],thumbnailByGuid:en,selectedNodeGuids:V,toggleSelectNode:ed,observe:ea}),""!==R&&(null===Y?a.createElement("div",{className:P.Do},a.createElement(m.kt,{size:"large"})):Object.entries(Y).length>0?Object.entries(Y).map(([e,t])=>a.createElement(T,{key:e,pageNode:S[e],nodes:t,thumbnailByGuid:en,selectedNodeGuids:V,toggleSelectNode:ed,showCollapsibleHeader:!0,observe:ea})):a.createElement("div",{className:P.Lp},a.createElement("div",null,(0,b.tx)("fig_feed.no_frames_matching",{searchQuery:a.createElement(a.Fragment,null,a.createElement("span",{className:P.ZF},R))})))))):null}},975723:(e,t,l)=>{l.r(t),l.d(t,{EditFeedPostModal:()=>Z});var a=l(411855),n=l(188507),s=l(629019),d=l.n(s),o=l(776250),r=l(609494),i=l(966712),c=l(498750),u=l(915440),m=l(27087),f=l(448169),p=l(946689),g=l(493323),E=l(881388),b=l(939863),h=l(392592),C=l(507877),v=l(662275),y=l(654034),k=l(694687),N=l(860178),I=l(279453),_=l(204279),P=l(531827),x=l(28588),M=l(103271),S=l(49218),O=l(588282),F=l(126674),T=l(679736),w=l(406158),K=l(301799),D=l(583630),R=l(660040),j=l(563288),A=l(160156),U=l(118143),L=l(782680),B=l(988898),Y=l(470400);function Z(e){let t=(0,n.wA)(),l=a.useCallback(()=>{t(v.Ce())},[t]),s=(0,b.tx)("fig_feed.edit_post"),d=e.feedPostUuid;!d&&e.feedPostThreadId&&(d=(0,O.gk)(e.feedPostThreadId));let o=(0,u.Rs)(I.FHz,{publicUuid:d},{enabled:!e.preloadedFeedPost&&!!d}),r=a.useMemo(()=>e.preloadedFeedPost?e.preloadedFeedPost:"loaded"===o.status?o.data.feedPost:null,[e.preloadedFeedPost,o]);return a.createElement(S.hZ,{header:a.createElement("div",{className:Y.Hc},s),onClose:l,maxWidth:S.Fo,disableFixedTop:!0,closeOnEsc:!0},r?a.createElement(q,{onSubmitSuccess:e.onSubmitSuccess,entryPoint:e.entryPoint,lockedFileKey:e.lockedFileKey,feedPost:r}):a.createElement("div",{className:Y._5},a.createElement(g.kt,{size:"large"})))}function q(e){let t=(0,n.wA)(),l=(0,k.sZ)(),s=(0,N.iZ)(),[u,I]=a.useState(!0),[S,O]=a.useState(!1),[Z,q]=a.useState(!1),z=(0,j.e3)(e.feedPost),G=e.feedPost.publicUuid,H=a.useMemo(()=>e.feedPost.content.map(e=>JSON.parse(e)),[e.feedPost]),[J,V]=a.useState(H.reduce((e,t)=>{if(t.type!==M.cM.NODE)return e;e.fileKey=t.fileKey;let l=t.nodeId;return e.nodeIds.push(l),e},{fileKey:e.feedPost.fileKey||"",nodeIds:[]})),W=a.useMemo(()=>{let e=H.find(e=>e.type===M.cM.PROTOTYPE);return e?{fileKey:e.fileKey,pageId:e.pageId,startingNodeId:e.startingNodeId}:null},[H]),[$,X]=a.useState(0),Q=a.useCallback(()=>{t(v.Ce())},[t]),ee=a.useCallback(()=>{t((0,v.to)({type:L.h,data:{onConfirm:Q},showModalsBeneath:!0}))},[t,Q]),et=e.lockedFileKey||J?.fileKey||W?.fileKey;a.useEffect(()=>{let t={entryPoint:e.entryPoint};et&&(t.fileKey=et),(0,o.sx)("Team Feed Edit Post Modal Opened",t)},[e.entryPoint,et]);let el=a.useCallback((e,a,n)=>{if(a){t(v.Ce());return}let s={text:(0,b.t)("fig_feed.view_post"),action:()=>{t(C.V3({url:(0,F.Kc)(l.id,{uuid:e})}))}};t(h.F.enqueue({message:(0,b.t)("fig_feed.post_edited"),button:n?s:void 0})),t(v.Ce())},[t,l]),[ea,en]=a.useState(H.map(e=>{let t=(0,w.EU)(e),l=(0,M.aT)(e)&&!!e.hasPreviousEditPreview,a={...e,copiedToS3:e.type===M.cM.NODE||e.type===M.cM.PROTOTYPE,shouldBlockEditPreview:l&&!t};return{displayContentItem:a,processedContentItem:Promise.resolve(a)}})),es=a.useMemo(()=>new Set(ea.map(e=>e.displayContentItem.type===M.cM.NODE?e.displayContentItem.nodeId:null).filter(e=>null!==e)),[ea]);a.useEffect(()=>{(0,K.sr)(J,es,en,l?.id)},[J,es,en,l?.id]);let ed=a.useCallback(e=>{let t=(0,A.K1)(ea[$].displayContentItem);X(e.findIndex(e=>(0,A.K1)(e)===t));let l=[];e.forEach(e=>{let t=(0,A.K1)(e),a=ea.find(e=>(0,A.K1)(e.displayContentItem)===t);a?l.push(a):console.error("Expected to have a matchedPendingItem")}),en(l)},[ea,$]),eo=a.useCallback(e=>{X(ea.findIndex(t=>(0,A.K1)(t.displayContentItem)===e))},[ea]),{setContentPreview:er,snapshotStates:ei}=(0,K.eh)(ea,en),{onSubmitSuccess:ec}=e,eu=a.useCallback((l,a)=>{m.Ay.put(`/api/feed_posts/${G}`,l).then(l=>{el(l.data.meta.public_uuid,a,e.entryPoint===T.M2.FILE),a&&t(h.F.enqueue({message:(0,b.t)("fig_feed.post_submission_pending")})),ec&&ec(a)}).catch(()=>{t(E.s.error((0,b.t)("fig_feed.error_on_feed_post_creation"))),I(!1)})},[t,el,ec,G,e.entryPoint]),[em,ef]=a.useState(e.feedPost.title||""),[ep,eg]=a.useState((0,y.o8)(e.feedPost.descriptionMeta)),eE=a.useMemo(()=>({library:new P.M8(l.id)}),[l]);a.useEffect(()=>{I(em.trim().length>R.Y||(0,r._Z)(ep).length>R.e||0===ea.length)},[em,ep,ea.length]);let eb=async a=>{if(!l||u)return;a?.preventDefault(),I(!0);let n={description_meta:ep,org_id:l.id},s=(0,r._Z)(ep);n.content=await (0,w.pj)(t,ea,et??"",em),(0,o.sx)("team_feed_content_awaited",{payloadContent:JSON.stringify(n.content)},{logFromProber:!0});let d=n.content.some(e=>e.pending);em?n.title=em:n.title=s.length>0?s.slice(0,40)+"\u2026":(0,b.t)("fig_feed.untitled_post"),et&&(n.attached_file_key=et),eu(n,d),(0,o.sx)("Team Feed Post Edited",{fileKey:et,entryPoint:e.entryPoint,text:s,numContentItems:n.content.length,contentItemTypes:n.content.map(e=>e.type)},{forwardToDatadog:!0})},eh=a.useCallback((e,a)=>{if(!l)return;let n=Array.from(e);if(0===n.length)return;let s=(0,_.KT)(n,ea.length,M.e3,M.bB,e=>{t(h.F.enqueue({message:(0,U.getUploadErrorMessage)(e)}))},ea.map(e=>e.fileIdentifier)).map(e=>{let t=(0,_.Fn)(e);if(x.xp.includes(e.type))return(0,w.zr)(t,e);if(x.VY.includes(e.type))return(0,w.X2)(t,G,l.id,e);throw Error("unexpected file type")}),d=void 0!==a?a:ea.length;en(e=>[...e.slice(0,d),...s,...e.slice(d)]),X(d)},[t,l,G,ea]),eC=a.useCallback((e,t)=>()=>{let l=e.current?.files||null;null!==l&&0!==l.length&&(eh(l,t),e.current&&(e.current.value=""))},[eh]),ev=a.useCallback(e=>{let t=Math.min(e,Math.max(0,ea.length-2)),l=ea[e];if((0,w.AK)(l),en(t=>t.filter((t,l)=>l!==e)),l.displayContentItem.type===M.cM.NODE){let e=l.displayContentItem.nodeId;V(t=>{if(t){let l=t.nodeIds.filter(t=>t!==e),a=t.nodeThumbnails,n=a&&l.reduce((e,t)=>(e[t]=a[t],e),{});return{...t,nodeIds:l,nodeThumbnails:n}}return null})}X(t)},[ea]),ey=a.useCallback((e,t)=>{eh(e.files,t),q(!1)},[eh]),ek=a.useRef(null),eN=!!J?.nodeIds?.length,{openPostFromFileModal:eI,attachedFileData:e_}=(0,K.Ld)({setLinkedFileNodeInfo:V,numUserContentItems:ea.length,hasNodeContent:eN,parentModalRef:ek,attachedFileKey:et,lockedFileKey:e.lockedFileKey,currentOrgId:l?.id}),eP=a.useCallback(()=>{let t=ea.map(e=>e.displayContentItem);return a.createElement(f.Y,{className:d()(Y.xe,Z&&Y.w8),isDragTarget:()=>!0,onTargetDragEnter:()=>q(!0),onTargetDragLeave:()=>q(!1),onTargetDrop:e=>ey(e)},a.createElement(A.Zo,{contentItems:t,staticContent:!0,scrollable:!1,deleteItemAtIdx:S?void 0:ev,pageBackgroundColor:e.feedPost.backgroundColor??void 0,onReorderCallback:S?void 0:ed,shouldScrollToIndex:null,selectedIdx:$,setSelectedIdx:X,onFileInputChange:eC,setSelectedContent:eo,snapshotStates:ei,setContentPreview:er,openPostFromFileModal:eI,attachedFile:e_,dragging:Z,mode:"edit"}))},[e.feedPost,Z,ed,ev,S,ea,ey,$,eC,eo,ei,er,eI,e_]),ex=a.useCallback(e=>{e.keyCode===c.Uz.ESCAPE&&Q()},[Q]);return l&&s&&(0,i.kc)().xr_debounce_threshold?a.createElement("div",{className:Y.RO,onKeyDown:ex,role:"textbox",tabIndex:0,ref:ek},a.createElement("div",{className:Y.q3},eP(),l&&s?a.createElement("div",{className:Y.DA},a.createElement(D.FeedPostUnifiedComposer,{user:s,currentOrgId:l.id,autofocus:!0,mentionables:eE,onSubmit:u?void 0:eb,submitOnEnter:!1,hideSubmitButton:!0,description:ep,updateDescription:eg,title:em,updateTitle:ef,displayDecoratorsDownwards:!0,minimized:!1,readOnly:S,editableTypeaheadClass:B.up,openPostFromFileModal:()=>eI({skipFrameSelection:!eN}),fileData:e_,lockFileAddition:ea.length>=M.e3,parentRef:ek,canUnlinkFile:!eN&&!e.lockedFileKey,unlinkFile:()=>V(null)})):null),a.createElement("div",{className:Y.CQ},a.createElement("div",{className:Y._f},a.createElement("div",{className:Y.oW},a.createElement("div",{className:Y.Ru},(0,b.tx)("fig_feed.post_to")),a.createElement("div",{className:Y.Ev},a.createElement("div",{className:Y.oj},a.createElement(j.lO,{containerInfo:z,withoutTooltip:!0}),a.createElement("div",{className:Y.JT},z.name))))),a.createElement("div",{className:Y.UD},a.createElement(p.nR,{onClick:e=>{e.stopPropagation(),ee()}},(0,b.tx)("fig_feed.discard_edit")),a.createElement(p.$$,{onClick:e=>{if(!S)return O(!0),eb(e).finally(()=>{O(!1)})},disabled:u,dataTestId:"feed-post-post",className:S?Y.zb:Y.pb},S&&a.createElement("div",{className:Y.YI},a.createElement(g.kt,{shouldMatchTextColor:!0,size:"medium"})),S?(0,b.tx)("fig_feed.saving"):(0,b.tx)("general.save"))))):null}}}]);

//# debugId=fc004411-036f-5b60-b3b0-2996a2556f17

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/dce647c3bc26d5bbd0f925dbda2d2d7784582222/team_feed-71f268e4e250df8e.min.js.map